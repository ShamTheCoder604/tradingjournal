<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShamsTradingJourney</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-black font-sans text-white">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Header -->
        <h1 class="text-5xl font-bold text-center mb-4 text-white">ShamsTradingJourney</h1>
        <!-- Balance and Progress -->
        <div class="mb-6">
            <label for="balance" class="block text-lg font-medium mb-2">Account Balance ($):</label>
            <input type="number" id="balance" value="100" step="0.01" class="w-full p-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <div class="mt-4">
                <label for="progress" class="block text-lg font-medium mb-2">Progress to $100,000:</label>
                <div class="w-full bg-gray-700 rounded-full h-4">
                    <div id="progress-bar" class="bg-blue-600 h-4 rounded-full" style="width: 0.1%"></div>
                </div>
                <p id="progress-text" class="text-sm mt-1">0.1% of goal ($100 / $100,000)</p>
            </div>
        </div>
        <!-- Checklist -->
        <div class="mb-6 p-4 bg-gray-800 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">USDJPY Trading Checklist</h2>
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span>EMA Alignment (5 & 13):</span>
                    <div class="space-x-2">
                        <button onclick="setChecklist('ema', true)" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Yes</button>
                        <button onclick="setChecklist('ema', false)" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">No</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span>MACD Confirmation:</span>
                    <div class="space-x-2">
                        <button onclick="setChecklist('macd', true)" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Yes</button>
                        <button onclick="setChecklist('macd', false)" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">No</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span>Pullback Identified:</span>
                    <div class="space-x-2">
                        <button onclick="setChecklist('pullback', true)" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Yes</button>
                        <button onclick="setChecklist('pullback', false)" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">No</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span>Supertrend Direction:</span>
                    <div class="space-x-2">
                        <button onclick="setChecklist('supertrend', true)" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Yes</button>
                        <button onclick="setChecklist('supertrend', false)" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">No</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span>Trade Count (Max 2/Day):</span>
                    <div class="space-x-2">
                        <button onclick="setChecklist('tradeCount', true)" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Yes</button>
                        <button onclick="setChecklist('tradeCount', false)" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">No</button>
                    </div>
                </div>
            </div>
            <button onclick="submitChecklist()" class="mt-4 w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md">Submit Checklist</button>
            <p id="checklist-result" class="mt-2 text-center font-medium"></p>
        </div>
        <!-- Trade Entry -->
        <div id="trade-entry" class="mb-6 p-4 bg-gray-800 rounded-lg shadow-md hidden">
            <h2 class="text-2xl font-semibold mb-4">Log Trade</h2>
            <div class="space-y-4">
                <div>
                    <label for="trade-outcome" class="block text-lg font-medium mb-2">Trade Outcome:</label>
                    <select id="trade-outcome" class="w-full p-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="win">Win</option>
                        <option value="loss">Loss</option>
                    </select>
                </div>
                <div>
                    <label for="trade-comments" class="block text-lg font-medium mb-2">Comments:</label>
                    <textarea id="trade-comments" class="w-full p-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                </div>
                <div>
                    <label for="trade-screenshot" class="block text-lg font-medium mb-2">Screenshot URL (Optional):</label>
                    <input type="text" id="trade-screenshot" class="w-full p-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Paste URL here" />
                </div>
            </div>
            <button onclick="logTrade()" class="mt-4 w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md">Log Trade</button>
        </div>
        <!-- Trade Log -->
        <div class="mb-6 p-4 bg-gray-800 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Trade Log</h2>
            <button onclick="loadTrades()" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md">Refresh Trades</button>
            <div id="trade-log" class="space-y-4"></div>
        </div>
        <!-- Risk and Lot Size -->
        <div class="mb-6 p-4 bg-gray-800 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Risk & Lot Size</h2>
            <p>Risk per Trade: <span id="risk-per-trade">0.2%</span></p>
            <p>Lot Size: <span id="lot-size">0.02</span></p>
        </div>
        <!-- Wins/Losses Chart -->
        <div class="p-4 bg-gray-800 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Wins vs Losses</h2>
            <canvas id="winLossChart"></canvas>
        </div>
    </div>

    <script>
        // Firebase Initialization
        const firebaseConfig = {
            apiKey: "AIzaSyBcAUB1jY7_D4Bh27omjl1RNwRe112z7iU",
            authDomain: "shamstradingjourney.firebaseapp.com",
            projectId: "shamstradingjourney",
            storageBucket: "shamstradingjourney.firebasestorage.app",
            messagingSenderId: "974388489062",
            appId: "1:974388489062:web:14b23d225b4687fb8236a7"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Checklist State
        let checklist = {
            ema: null,
            macd: null,
            pullback: null,
            supertrend: null,
            tradeCount: null
        };

        // Trade Data
        let trades = [];
        let balance = parseFloat(document.getElementById('balance').value) || 100;
        const goal = 100000;
        let wins = 0, losses = 0;

        // Chart
        const ctx = document.getElementById('winLossChart').getContext('2d');
        const winLossChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Wins',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    fill: false
                }, {
                    label: 'Losses',
                    data: [],
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: 'Trade Number', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                    y: { title: { display: true, text: 'Count', color: '#ffffff' }, ticks: { color: '#ffffff' }, beginAtZero: true }
                },
                plugins: { legend: { labels: { color: '#ffffff' } } },
                responsive: true,
                maintainAspectRatio: false,
                backgroundColor: 'transparent'
            }
        });

        // Update Balance and Progress
        function updateBalanceAndProgress() {
            balance = parseFloat(document.getElementById('balance').value) || 100;
            const progress = (balance / goal) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${progress.toFixed(2)}% of goal ($${balance.toFixed(2)} / $${goal.toFixed(2)})`;
            updateRiskAndLotSize();
        }

        // Update Risk and Lot Size
        function updateRiskAndLotSize() {
            const riskPerTrade = (balance * 0.002).toFixed(2); // 0.2% risk
            const lotSize = (riskPerTrade / 1000).toFixed(2); // Simplified lot size calc
            document.getElementById('risk-per-trade').textContent = `$${riskPerTrade}`;
            document.getElementById('lot-size').textContent = lotSize;
        }

        // Load Trades from Firestore
        async function loadTrades() {
            trades = [];
            const snapshot = await db.collection('trades').orderBy('tradeNumber').get();
            snapshot.forEach(doc => {
                trades.push(doc.data());
            });
            renderTradeLog();
            updateChart();
        }

        // Save Trade to Firestore
        async function saveTrade(trade) {
            const tradeId = Date.now().toString();
            await db.collection('trades').doc(tradeId).set(trade);
            trades.push(trade);
            renderTradeLog();
            updateChart();
        }

        // Delete Trade from Firestore
        async function deleteTrade(tradeId) {
            await db.collection('trades').doc(tradeId).delete();
            trades = trades.filter(trade => trade.tradeId !== tradeId);
            renderTradeLog();
            updateChart();
        }

        // Render Trade Log
        function renderTradeLog() {
            const tradeLog = document.getElementById('trade-log');
            tradeLog.innerHTML = '';
            trades.forEach(trade => {
                const tradeDiv = document.createElement('div');
                tradeDiv.className = 'p-4 bg-gray-700 rounded-lg';
                tradeDiv.innerHTML = `
                    <p><strong>Trade #${trade.tradeNumber}</strong>: ${trade.outcome.charAt(0).toUpperCase() + trade.outcome.slice(1)}</p>
                    <p>Comments: ${trade.comments}</p>
                    ${trade.screenshot ? `<p><a href="${trade.screenshot}" target="_blank" class="text-blue-400 underline">View Screenshot</a></p>` : ''}
                    <button onclick="deleteTrade('${trade.tradeId}')" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md">Delete</button>
                `;
                tradeLog.appendChild(tradeDiv);
            });
        }

        // Update Chart
        function updateChart() {
            wins = trades.filter(trade => trade.outcome === 'win').length;
            losses = trades.filter(trade => trade.outcome === 'loss').length;
            const labels = trades.map(trade => trade.tradeNumber);
            const winData = trades.map(trade => trade.outcome === 'win' ? 1 : 0);
            const lossData = trades.map(trade => trade.outcome === 'loss' ? 1 : 0);
            winLossChart.data.labels = labels;
            winLossChart.data.datasets[0].data = winData;
            winLossChart.data.datasets[1].data = lossData;
            winLossChart.update();
        }

        // Set Checklist Item
        function setChecklist(item, value) {
            checklist[item] = value;
            document.getElementById('checklist-result').textContent = '';
            document.getElementById('trade-entry').classList.add('hidden');
        }

        // Submit Checklist
        function submitChecklist() {
            const allYes = Object.values(checklist).every(value => value === true);
            const resultText = allYes ? 'Green Light: Proceed with Trade' : 'Reject: Checklist Not Met';
            document.getElementById('checklist-result').textContent = resultText;
            document.getElementById('checklist-result').className = `mt-2 text-center font-medium ${allYes ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('trade-entry').classList.toggle('hidden', !allYes);
        }

        // Log Trade
        function logTrade() {
            const outcome = document.getElementById('trade-outcome').value;
            const comments = document.getElementById('trade-comments').value;
            const screenshot = document.getElementById('trade-screenshot').value;
            const tradeNumber = trades.length + 1;
            const trade = { tradeId: Date.now().toString(), tradeNumber, outcome, comments, screenshot };
            saveTrade(trade);
            if (outcome === 'win') {
                balance *= 1.2; // 20% gain
            } else {
                balance *= 0.998; // 0.2% loss
            }
            document.getElementById('balance').value = balance.toFixed(2);
            updateBalanceAndProgress();
            document.getElementById('trade-entry').classList.add('hidden');
            document.getElementById('checklist-result').textContent = '';
            Object.keys(checklist).forEach(key => checklist[key] = null);
        }

        // Event Listeners
        document.getElementById('balance').addEventListener('input', updateBalanceAndProgress);

        // Initial Load
        updateBalanceAndProgress();
        loadTrades();
    </script>
</body>
</html>
