<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trading Journal</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4 space-y-6">

  <h1 class="text-3xl font-bold mt-4">üìà Trading Journal</h1>

  <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md space-y-4 shadow-lg">
    <div>
      <label class="block mb-1 text-sm">Current Balance ($)</label>
      <input id="balance" type="number" value="100" onchange="updateUI()" class="w-full p-2 rounded-lg bg-gray-700 text-white" />
    </div>

    <div class="space-y-2 text-sm text-gray-300">
      <div>Risk Per Trade: <span id="risk-per-trade"></span></div>
      <div>Lot Size: <span id="lot-size"></span></div>
      <div>Margin Required: <span id="margin-required"></span></div>
    </div>

    <div class="w-full bg-gray-700 h-4 rounded-lg overflow-hidden">
      <div id="progress-bar" class="h-4 bg-green-500" style="width: 0%"></div>
    </div>
    <div id="progress-text" class="text-xs text-center mt-1"></div>

    <div class="flex flex-col space-y-2">
      <select id="trade-outcome" class="p-2 bg-gray-700 rounded-lg">
        <option value="win">‚úÖ Win</option>
        <option value="loss">‚ùå Loss</option>
      </select>

      <input id="trade-comments" type="text" placeholder="Comments (optional)" class="p-2 rounded-lg bg-gray-700" />
      <input id="trade-screenshot-url" type="text" placeholder="Screenshot URL (optional)" class="p-2 rounded-lg bg-gray-700" />

      <button onclick="logTrade()" class="bg-green-500 hover:bg-green-600 p-2 rounded-lg font-bold">Log Trade</button>
    </div>
  </div>

  <div id="trade-log" class="w-full max-w-md flex flex-col space-y-4 mt-6"></div>

  <script>
    // üî• Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // üß† Calculate lot size and risk
    function calculateLotSize(balance) {
      const riskPercent = 0.2; // 20%
      const riskAmount = balance * riskPercent;
      const stopLossPips = 20;
      const currentPrice = 150;
      const pipValuePerStandardLot = (0.01 / currentPrice) * 100000; // ~6.67

      let lotSize = riskAmount / (stopLossPips * pipValuePerStandardLot);

      const marginPerLot = (currentPrice * 100000) / 500;
      const maxLotsByMargin = balance / marginPerLot;

      lotSize = Math.min(lotSize, maxLotsByMargin);

      return {
        lotSize: lotSize.toFixed(2),
        riskAmount: riskAmount.toFixed(2),
        marginRequired: (lotSize * marginPerLot).toFixed(2)
      };
    }

    // üöÄ Update UI
    function updateUI() {
      const balanceInput = parseFloat(document.getElementById('balance').value) || 100;
      const { lotSize, riskAmount, marginRequired } = calculateLotSize(balanceInput);
      const progress = (balanceInput / 100000) * 100;

      document.getElementById('risk-per-trade').textContent = `$${riskAmount} (20%)`;
      document.getElementById('lot-size').textContent = lotSize;
      document.getElementById('margin-required').textContent = `$${marginRequired}`;
      document.getElementById('progress-bar').style.width = `${progress}%`;
      document.getElementById('progress-text').textContent = `${progress.toFixed(2)}% ($${balanceInput} / $100,000)`;
    }

    // üìã Load trades
    async function loadTrades() {
      const tradeLog = document.getElementById('trade-log');
      tradeLog.innerHTML = '';
      const snapshot = await db.collection('trades').orderBy('timestamp', 'desc').get();
      snapshot.forEach(doc => {
        const trade = doc.data();
        tradeLog.innerHTML += `
          <div class="p-4 bg-gray-700 rounded-xl shadow-lg space-y-2">
            <div class="flex justify-between items-center">
              <span class="font-bold text-lg">${trade.outcome === 'win' ? '‚úÖ Win' : '‚ùå Loss'}</span>
              <span class="text-sm text-gray-300">${new Date(trade.timestamp).toLocaleDateString()}</span>
            </div>
            <p class="text-gray-400">${trade.comments || 'No comments.'}</p>
            ${trade.screenshotURL ? `<img src="${trade.screenshotURL}" class="mt-2 rounded-lg" />` : ''}
            <div class="flex justify-between text-sm text-gray-400 mt-2">
              <span>Balance After: $${trade.balanceAfter.toFixed(2)}</span>
              <span>Lot Size: ${trade.lotSize}</span>
            </div>
          </div>
        `;
      });
    }

    // ‚ûï Log new trade
    async function logTrade() {
      const outcome = document.getElementById('trade-outcome').value;
      const comments = document.getElementById('trade-comments').value;
      const screenshotURL = document.getElementById('trade-screenshot-url').value;

      const balanceInput = parseFloat(document.getElementById('balance').value) || 100;
      let { lotSize, riskAmount } = calculateLotSize(balanceInput);

      let newBalance = outcome === 'win' 
        ? balanceInput + parseFloat(riskAmount) 
        : balanceInput - parseFloat(riskAmount);

      await db.collection('trades').add({
        outcome,
        comments,
        screenshotURL,
        balanceAfter: newBalance,
        lotSize: parseFloat(lotSize),
        timestamp: Date.now()
      });

      document.getElementById('balance').value = newBalance.toFixed(2);
      updateUI();
      loadTrades();
    }

    // üèÅ Initial load
    updateUI();
    loadTrades();
  </script>

</body>
</html>
